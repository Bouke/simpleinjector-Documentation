<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Collection Registration Extension &mdash; Simple Injector 2 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Simple Injector 2 documentation" href="index.html" />
    <link rel="up" title="Appendix" href="appendix.html" />
    <link rel="next" title="Context Dependent Extensions" href="ContextDependentExtensions.html" />
    <link rel="prev" title="Interception Extensions" href="InterceptionExtensions.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="ContextDependentExtensions.html" title="Context Dependent Extensions"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="InterceptionExtensions.html" title="Interception Extensions"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">Simple Injector 2 documentation</a> &raquo;</li>
          <li><a href="appendix.html" accesskey="U">Appendix</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="collection-registration-extension">
<h1>Collection Registration Extension<a class="headerlink" href="#collection-registration-extension" title="Permalink to this headline">Â¶</a></h1>
<p><strong>Allowing the Simple Injector to resolve arrays and other list types.</strong></p>
<p>The default behavior of <em>Simple Injector</em> is to resolve collections of types through the <em>IEnumerable&lt;T&gt;</em> interface. Resolving a set of elements using other collection types is possible by registrering a mapping on a per type basis, such as can be seen the following example:</p>
<div class="highlight-c#"><div class="highlight"><pre><span class="n">container</span><span class="p">.</span><span class="n">RegisterAll</span><span class="p">&lt;</span><span class="n">IFilter</span><span class="p">&gt;(</span>
    <span class="k">typeof</span><span class="p">(</span><span class="n">SqlFilter</span><span class="p">),</span> <span class="k">typeof</span><span class="p">(</span><span class="n">XssFilter</span><span class="p">),</span> <span class="k">typeof</span><span class="p">(</span><span class="n">SmartFilter</span><span class="p">));</span>

<span class="n">container</span><span class="p">.</span><span class="n">Register</span><span class="p">&lt;</span><span class="n">IFilter</span><span class="p">[]&gt;(</span>

    <span class="p">()</span> <span class="p">=&gt;</span> <span class="n">container</span><span class="p">.</span><span class="n">GetAllInstances</span><span class="p">&lt;</span><span class="n">IFilter</span><span class="p">&gt;().</span><span class="n">ToArray</span><span class="p">());</span>
</pre></div>
</div>
<p>When having many collections of types that need to be resolved in this way, the registration can be come cumbersome. Alternatively you can revert to unregistered type resolution, as can be seen in the following example:</p>
<div class="highlight-c#"><div class="highlight"><pre><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Linq</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Linq.Expressions</span><span class="p">;</span>

<span class="k">using</span> <span class="nn">SimpleInjector</span><span class="p">;</span>

<span class="k">public</span> <span class="k">static</span> <span class="k">class</span> <span class="nc">CollectionRegistrationExtensions</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">AllowToResolveArraysAndLists</span><span class="p">(</span>
        <span class="k">this</span> <span class="n">Container</span> <span class="n">container</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">container</span><span class="p">.</span><span class="n">ResolveUnregisteredType</span> <span class="p">+=</span> <span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span> <span class="p">=&gt;</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">serviceType</span> <span class="p">=</span> <span class="n">e</span><span class="p">.</span><span class="n">UnregisteredServiceType</span><span class="p">;</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">serviceType</span><span class="p">.</span><span class="n">IsArray</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">RegisterArrayResolver</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span>
                    <span class="n">serviceType</span><span class="p">.</span><span class="n">GetElementType</span><span class="p">());</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="nf">if</span> <span class="p">(</span><span class="n">serviceType</span><span class="p">.</span><span class="n">IsGenericType</span> <span class="p">&amp;&amp;</span>
                <span class="n">serviceType</span><span class="p">.</span><span class="n">GetGenericTypeDefinition</span><span class="p">()</span> <span class="p">==</span> <span class="k">typeof</span><span class="p">(</span><span class="n">IList</span><span class="p">&lt;&gt;))</span>
            <span class="p">{</span>
                <span class="n">RegisterArrayResolver</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span>
                    <span class="n">serviceType</span><span class="p">.</span><span class="n">GetGenericArguments</span><span class="p">()[</span><span class="m">0</span><span class="p">]);</span>
            <span class="p">}</span>
        <span class="p">};</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">RegisterArrayResolver</span><span class="p">(</span><span class="n">UnregisteredTypeEventArgs</span> <span class="n">e</span><span class="p">,</span>
        <span class="n">Container</span> <span class="n">container</span><span class="p">,</span> <span class="n">Type</span> <span class="n">elementType</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">producer</span> <span class="p">=</span> <span class="n">container</span><span class="p">.</span><span class="n">GetRegistration</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">IEnumerable</span><span class="p">&lt;&gt;)</span>
            <span class="p">.</span><span class="n">MakeGenericType</span><span class="p">(</span><span class="n">elementType</span><span class="p">));</span>
        <span class="kt">var</span> <span class="n">enumerableExpression</span> <span class="p">=</span> <span class="n">producer</span><span class="p">.</span><span class="n">BuildExpression</span><span class="p">();</span>
        <span class="kt">var</span> <span class="n">arrayMethod</span> <span class="p">=</span> <span class="k">typeof</span><span class="p">(</span><span class="n">Enumerable</span><span class="p">).</span><span class="n">GetMethod</span><span class="p">(</span><span class="s">&quot;ToArray&quot;</span><span class="p">)</span>
            <span class="p">.</span><span class="n">MakeGenericMethod</span><span class="p">(</span><span class="n">elementType</span><span class="p">);</span>
        <span class="kt">var</span> <span class="n">arrayExpression</span> <span class="p">=</span>
            <span class="n">Expression</span><span class="p">.</span><span class="n">Call</span><span class="p">(</span><span class="n">arrayMethod</span><span class="p">,</span> <span class="n">enumerableExpression</span><span class="p">);</span>

        <span class="n">e</span><span class="p">.</span><span class="n">Register</span><span class="p">(</span><span class="n">arrayExpression</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>After copying the previous code snippet to your project, you can allow mapping of array and <em>IList&lt;T&gt;</em> types to <em>IEnumerable&lt;T&gt;</em> for all registered collections, with the following lines:</p>
<div class="highlight-c#"><div class="highlight"><pre><span class="n">container</span><span class="p">.</span><span class="n">AllowToResolveArraysAndLists</span><span class="p">();</span>
</pre></div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h4>Previous topic</h4>
  <p class="topless"><a href="InterceptionExtensions.html"
                        title="previous chapter">Interception Extensions</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="ContextDependentExtensions.html"
                        title="next chapter">Context Dependent Extensions</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/CollectionRegistrationExtensions.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="ContextDependentExtensions.html" title="Context Dependent Extensions"
             >next</a> |</li>
        <li class="right" >
          <a href="InterceptionExtensions.html" title="Interception Extensions"
             >previous</a> |</li>
        <li><a href="index.html">Simple Injector 2 documentation</a> &raquo;</li>
          <li><a href="appendix.html" >Appendix</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014, Simple Injector Contributors.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>