<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Diagnostic Warning - Short Circuited Dependencies &mdash; Simple Injector 2 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Simple Injector 2 documentation" href="index.html" />
    <link rel="up" title="Diagnostic Services" href="diagnostics.html" />
    <link rel="next" title="Diagnostic Warning - Potential Single Responsibility Violations" href="PotentialSingleResponsibilityViolations.html" />
    <link rel="prev" title="Diagnostic Warning - Potential Lifestyle Mismatches" href="PotentialLifestyleMismatches.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="PotentialSingleResponsibilityViolations.html" title="Diagnostic Warning - Potential Single Responsibility Violations"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="PotentialLifestyleMismatches.html" title="Diagnostic Warning - Potential Lifestyle Mismatches"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">Simple Injector 2 documentation</a> &raquo;</li>
          <li><a href="diagnostics.html" accesskey="U">Diagnostic Services</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="diagnostic-warning-short-circuited-dependencies">
<h1>Diagnostic Warning - Short Circuited Dependencies<a class="headerlink" href="#diagnostic-warning-short-circuited-dependencies" title="Permalink to this headline">¶</a></h1>
<div class="section" id="cause">
<h2>Cause<a class="headerlink" href="#cause" title="Permalink to this headline">¶</a></h2>
<p>The component depends on an unregistered concrete type and this concrete type has a lifestyle that is different than the lifestyle of an explicitly registered type that uses this concrete type as its implementation.</p>
</div>
<div class="section" id="warning-description">
<h2>Warning Description<a class="headerlink" href="#warning-description" title="Permalink to this headline">¶</a></h2>
<p>This warning signals the possible use of a short circuited dependency in a component. A short circuited dependency is:</p>
<ul class="simple">
<li>a concrete type</li>
<li>that is not registered by itself</li>
<li>that is referenced by another component (most likely using a constructor argument)</li>
<li>and exists as <strong>TImplementation</strong> in an explicitly made <em>Register&lt;TService, TImplementation&gt;()</em> registration (or its non-generic equivalent)</li>
<li>and where the lifestyle of this explicit registration differs from the unregistered type (in normal cases this means that the explicit registration is not <em>Transient</em>)</li>
</ul>
<p>When a component depends on a short circuited dependency, the application might be wired incorrectly because the flagged component gets a different instance of that concrete type than other components in the application will get. This can result in incorrect behavior.</p>
</div>
<div class="section" id="how-to-fix-violations">
<h2>How to Fix Violations<a class="headerlink" href="#how-to-fix-violations" title="Permalink to this headline">¶</a></h2>
<p>Let the component depend on the abstraction described in the warning message instead of depending directly on the concrete type. If the warning is a false positive and the component (and all other components that depend directly on this concrete type) should indeed get a transient instance of that concrete type, register the concrete type explicitly in the contain using the transient lifestyle.</p>
</div>
<div class="section" id="when-to-ignore-warnings">
<h2>When to Ignore Warnings<a class="headerlink" href="#when-to-ignore-warnings" title="Permalink to this headline">¶</a></h2>
<p>Do not ignore these warnings. False positives for this warning are rare and even when they occur, the registration or the application design can always be changed or the concrete type can be registered explicitly in the container.</p>
</div>
<div class="section" id="example">
<h2>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h2>
<div class="highlight-c#"><div class="highlight"><pre><span class="kt">var</span> <span class="n">container</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Container</span><span class="p">();</span>

<span class="n">container</span><span class="p">.</span><span class="n">RegisterPerWebRequest</span><span class="p">&lt;</span><span class="n">IUnitOfWork</span><span class="p">,</span> <span class="n">MyUnitOfWork</span><span class="p">&gt;();</span>
<span class="n">container</span><span class="p">.</span><span class="n">Register</span><span class="p">&lt;</span><span class="n">HomeController</span><span class="p">&gt;();</span>

<span class="c1">// Definition of HomeController</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">HomeController</span> <span class="p">:</span> <span class="n">Controller</span> <span class="p">{</span>
    <span class="k">private</span> <span class="k">readonly</span> <span class="n">MyUnitOfWork</span> <span class="n">uow</span><span class="p">;</span>

    <span class="k">public</span> <span class="nf">HomeController</span><span class="p">(</span><span class="n">MyUnitOfWork</span> <span class="n">uow</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="n">uow</span> <span class="p">=</span> <span class="n">uow</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In this example <strong>HomeController</strong> depends on <strong>MyUnitOfWork</strong>. <strong>MyUnitOfWork</strong> however is not registered explicitly, but <strong>IUnitOfWork</strong> is. Furthermore <strong>IUnitOfWork</strong> is registered with the <strong>WebRequestLifestyle</strong>. However, since <strong>MyUnitOfWork</strong> is a concrete unregistered type, the container will create it on your behalf with the <em>Transient</em> lifestyle. This will typically be a problem, since during a request, the <strong>HomeController</strong> will get a different instance than other types that depend on <strong>IUnitOfWork</strong> while the intended use of <strong>IUnitOfWork</strong> is to have a single instance per web request.</p>
<p>For Unit of Work implementations this is typically a problem, since the unit of work defines an atomic operation and creating multiple instances of such a unit of work in a single web request means that the work is split up in multiple (database) transactions (breaking consistency) or could result in part of the work not being committed at all.</p>
<p>The <strong>MyUnitOfWork</strong> type is called &#8216;short circuited&#8217; because <strong>HomeController</strong> skips the <strong>IUnitOfWork</strong> dependency and directly depends on <strong>MyUnitOfWork</strong>. In other words, <strong>HomeController</strong> short circuits to <strong>MyUnitOfWork</strong>.</p>
<p>Here is an example of a short circuited dependency in the watch window:</p>
<img alt="Debugger watch window showing short circuited dependency" src="_images/shortcircuited.png" />
<p>The following example shows how to query the Diagnostic API for Short Circuited Dependencies:</p>
<div class="highlight-c#"><div class="highlight"><pre><span class="c1">// using SimpleInjector.Diagnostics;</span>

<span class="kt">var</span> <span class="n">container</span> <span class="p">=</span> <span class="cm">/* get verified container */</span><span class="p">;</span>

<span class="kt">var</span> <span class="n">results</span> <span class="p">=</span> <span class="n">Analyzer</span><span class="p">.</span><span class="n">Analyze</span><span class="p">(</span><span class="n">container</span><span class="p">)</span>
    <span class="p">.</span><span class="n">OfType</span><span class="p">&lt;</span><span class="n">ShortCircuitedDependencyDiagnosticResult</span><span class="p">&gt;();</span>

<span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">result</span> <span class="k">in</span> <span class="n">results</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">Description</span><span class="p">);</span>
    <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span>
        <span class="s">&quot;Lifestyle of service with the short circuited dependency: &quot;</span> <span class="p">+</span>
        <span class="n">result</span><span class="p">.</span><span class="n">Relationship</span><span class="p">.</span><span class="n">Lifestyle</span><span class="p">.</span><span class="n">Name</span><span class="p">);</span>

    <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;One of the following types was expected instead:&quot;</span><span class="p">);</span>
    <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">expected</span> <span class="k">in</span> <span class="n">result</span><span class="p">.</span><span class="n">ExpectedDependencies</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;-&quot;</span> <span class="p">+</span> <span class="n">expected</span><span class="p">.</span><span class="n">ServiceType</span><span class="p">.</span><span class="n">FullName</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="note container">
<strong>Note</strong>: The Diagnostic API is new in <em>Simple Injector v2.4</em>.</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Diagnostic Warning - Short Circuited Dependencies</a><ul>
<li><a class="reference internal" href="#cause">Cause</a></li>
<li><a class="reference internal" href="#warning-description">Warning Description</a></li>
<li><a class="reference internal" href="#how-to-fix-violations">How to Fix Violations</a></li>
<li><a class="reference internal" href="#when-to-ignore-warnings">When to Ignore Warnings</a></li>
<li><a class="reference internal" href="#example">Example</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="PotentialLifestyleMismatches.html"
                        title="previous chapter">Diagnostic Warning - Potential Lifestyle Mismatches</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="PotentialSingleResponsibilityViolations.html"
                        title="next chapter">Diagnostic Warning - Potential Single Responsibility Violations</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/ShortCircuitedDependencies.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="PotentialSingleResponsibilityViolations.html" title="Diagnostic Warning - Potential Single Responsibility Violations"
             >next</a> |</li>
        <li class="right" >
          <a href="PotentialLifestyleMismatches.html" title="Diagnostic Warning - Potential Lifestyle Mismatches"
             >previous</a> |</li>
        <li><a href="index.html">Simple Injector 2 documentation</a> &raquo;</li>
          <li><a href="diagnostics.html" >Diagnostic Services</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014, Simple Injector Contributors.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>