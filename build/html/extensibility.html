

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Extensibility Points &mdash; Simple Injector 2 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="top" title="Simple Injector 2 documentation" href="index.html"/>
        <link rel="next" title="Simple Injector Pipeline" href="pipeline.html"/>
        <link rel="prev" title="Advanced Scenarios" href="advanced.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        <a href="index.html" class="fa fa-home"> Simple Injector</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
        
            <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quick Start</a><ul>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html#getting-started">Getting started</a></li>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html#a-quick-example">A Quick Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html#more-information">More information</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="using.html">Using Simple Injector</a><ul>
<li class="toctree-l2"><a class="reference internal" href="using.html#resolving-instances">Resolving instances</a></li>
<li class="toctree-l2"><a class="reference internal" href="using.html#configuring-simple-injector">Configuring Simple Injector</a></li>
<li class="toctree-l2"><a class="reference internal" href="using.html#verifying-the-container-s-configuration">Verifying the container&#8217;s configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="using.html#automatic-constructor-injection-auto-wiring">Automatic constructor injection / auto-wiring</a></li>
<li class="toctree-l2"><a class="reference internal" href="using.html#more-information">More information</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="lifetimes.html">Object Lifetime Management</a><ul>
<li class="toctree-l2"><a class="reference internal" href="lifetimes.html#transient">Transient</a></li>
<li class="toctree-l2"><a class="reference internal" href="lifetimes.html#singleton">Singleton</a></li>
<li class="toctree-l2"><a class="reference internal" href="lifetimes.html#scoped">Scoped</a></li>
<li class="toctree-l2"><a class="reference internal" href="lifetimes.html#per-web-request">Per Web Request</a></li>
<li class="toctree-l2"><a class="reference internal" href="lifetimes.html#per-web-api-request">Per Web API Request</a></li>
<li class="toctree-l2"><a class="reference internal" href="lifetimes.html#web-api-request-lifestyle-vs-web-request-lifestyle">Web API Request lifestyle vs. Web Request lifestyle</a></li>
<li class="toctree-l2"><a class="reference internal" href="lifetimes.html#per-wcf-operation">Per WCF Operation</a></li>
<li class="toctree-l2"><a class="reference internal" href="lifetimes.html#per-lifetime-scope">Per Lifetime Scope</a></li>
<li class="toctree-l2"><a class="reference internal" href="lifetimes.html#per-execution-context-scope">Per Execution Context Scope</a></li>
<li class="toctree-l2"><a class="reference internal" href="lifetimes.html#per-graph">Per Graph</a></li>
<li class="toctree-l2"><a class="reference internal" href="lifetimes.html#per-thread">Per Thread</a></li>
<li class="toctree-l2"><a class="reference internal" href="lifetimes.html#per-http-session">Per HTTP Session</a></li>
<li class="toctree-l2"><a class="reference internal" href="lifetimes.html#hybrid">Hybrid</a></li>
<li class="toctree-l2"><a class="reference internal" href="lifetimes.html#developing-a-custom-lifestyle">Developing a Custom Lifestyle</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="integration.html">Integration Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="mvcintegration.html">    ASP.NET MVC</a></li>
<li class="toctree-l2"><a class="reference internal" href="webapiintegration.html">    ASP.NET Web API</a></li>
<li class="toctree-l2"><a class="reference internal" href="webformsintegration.html">    ASP.NET Web Forms</a></li>
<li class="toctree-l2"><a class="reference internal" href="windowsformsintegration.html">    Windows Forms</a></li>
<li class="toctree-l2"><a class="reference internal" href="wcfintegration.html">    WCF</a></li>
<li class="toctree-l2"><a class="reference internal" href="wpfintegration.html">    WPF and Silverlight</a></li>
<li class="toctree-l2"><a class="reference internal" href="integration.html#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="diagnostics.html">Diagnostic Services</a><ul>
<li class="toctree-l2"><a class="reference internal" href="diagnostics.html#how-to-view-diagnostic-results">How to view diagnostic results</a></li>
<li class="toctree-l2"><a class="reference internal" href="diagnostics.html#limitations">Limitations</a></li>
<li class="toctree-l2"><a class="reference internal" href="diagnostics.html#supported-warnings">Supported Warnings</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="howto.html">How To</a><ul>
<li class="toctree-l2"><a class="reference internal" href="howto.html#register-factory-delegates">Register factory delegates</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto.html#resolve-instances-by-key">Resolve instances by key</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto.html#resolve-arrays-and-lists">Resolve arrays and lists</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto.html#register-multiple-interfaces-with-the-same-implementation">Register multiple interfaces with the same implementation</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto.html#override-existing-registrations">Override existing registrations</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto.html#verify-the-containers-configuration">Verify the containerâ€™s configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto.html#work-with-dependency-injection-in-multi-threaded-applications">Work with dependency injection in multi-threaded applications</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="advanced.html">Advanced Scenarios</a><ul>
<li class="toctree-l2"><a class="reference internal" href="advanced.html#generics">Generics</a></li>
<li class="toctree-l2"><a class="reference internal" href="advanced.html#batch-automatic-registration">Batch / Automatic registration</a></li>
<li class="toctree-l2"><a class="reference internal" href="advanced.html#registration-of-open-generic-types">Registration of open generic types</a></li>
<li class="toctree-l2"><a class="reference internal" href="advanced.html#mixing-collections-of-open-generic-and-non-generic-components">Mixing collections of open-generic and non-generic components</a></li>
<li class="toctree-l2"><a class="reference internal" href="advanced.html#unregistered-type-resolution">Unregistered type resolution</a></li>
<li class="toctree-l2"><a class="reference internal" href="advanced.html#context-based-injection">Context based injection</a></li>
<li class="toctree-l2"><a class="reference internal" href="advanced.html#decorators">Decorators</a></li>
<li class="toctree-l2"><a class="reference internal" href="advanced.html#interception">Interception</a></li>
<li class="toctree-l2"><a class="reference internal" href="advanced.html#property-injection">Property injection</a></li>
<li class="toctree-l2"><a class="reference internal" href="advanced.html#covariance-and-contravariance">Covariance and Contravariance</a></li>
<li class="toctree-l2"><a class="reference internal" href="advanced.html#registering-plugins-dynamically">Registering plugins dynamically</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Extensibility Points</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#overriding-constructor-resolution-behavior">Overriding Constructor Resolution Behavior</a></li>
<li class="toctree-l2"><a class="reference internal" href="#property-injection">Property Injection</a></li>
<li class="toctree-l2"><a class="reference internal" href="#overriding-parameter-injection-behavior">Overriding Parameter Injection Behavior</a></li>
<li class="toctree-l2"><a class="reference internal" href="#resolving-unregistered-types">Resolving Unregistered Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="#overriding-lifestyle-selection-behavior">Overriding Lifestyle Selection Behavior</a></li>
<li class="toctree-l2"><a class="reference internal" href="#intercepting-the-creation-of-types">Intercepting the Creation of Types</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="pipeline.html">Simple Injector Pipeline</a><ul>
<li class="toctree-l2"><a class="reference internal" href="pipeline.html#registration-pipeline">Registration Pipeline</a></li>
<li class="toctree-l2"><a class="reference internal" href="pipeline.html#resolve-pipeline">Resolve Pipeline</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="principles.html">Design Principles</a><ul>
<li class="toctree-l2"><a class="reference internal" href="principles.html#make-simple-use-cases-easy-make-complex-use-cases-possible">Make simple use cases easy, make complex use cases possible</a></li>
<li class="toctree-l2"><a class="reference internal" href="principles.html#push-developers-into-best-practices">Push developers into best practices</a></li>
<li class="toctree-l2"><a class="reference internal" href="principles.html#fast-by-default">Fast by default</a></li>
<li class="toctree-l2"><a class="reference internal" href="principles.html#don-t-force-vendor-lock-in">Don&#8217;t force vendor lock-in</a></li>
<li class="toctree-l2"><a class="reference internal" href="principles.html#never-fail-silently">Never fail silently</a></li>
<li class="toctree-l2"><a class="reference internal" href="principles.html#features-should-be-intuitive">Features should be intuitive</a></li>
<li class="toctree-l2"><a class="reference internal" href="principles.html#communicate-errors-clearly-and-describe-how-to-solve-them">Communicate errors clearly and describe how to solve them</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="decisions.html">Design Decisions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="decisions.html#the-container-is-locked-after-the-first-call-to-resolve">The container is locked after the first call to resolve</a></li>
<li class="toctree-l2"><a class="reference internal" href="decisions.html#the-api-clearly-differentiates-the-registration-of-collections">The API clearly differentiates the registration of collections</a></li>
<li class="toctree-l2"><a class="reference internal" href="decisions.html#no-support-for-xml-based-configuration">No support for XML based configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="decisions.html#never-force-users-to-release-what-they-resolve">Never force users to release what they resolve</a></li>
<li class="toctree-l2"><a class="reference internal" href="decisions.html#dont-allow-resolving-scoped-instances-outside-an-active-scope">Donâ€™t allow resolving scoped instances outside an active scope</a></li>
<li class="toctree-l2"><a class="reference internal" href="decisions.html#no-out-of-the-box-support-for-property-injection">No out-of-the-box support for property injection</a></li>
<li class="toctree-l2"><a class="reference internal" href="decisions.html#no-out-of-the-box-support-for-interception">No out-of-the-box support for interception</a></li>
<li class="toctree-l2"><a class="reference internal" href="decisions.html#limited-batch-registration-api">Limited batch-registration API</a></li>
<li class="toctree-l2"><a class="reference internal" href="decisions.html#no-per-thread-lifestyle">No per-thread lifestyle</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="legal.html">Legal stuff</a><ul>
<li class="toctree-l2"><a class="reference internal" href="legal.html#simple-injector-license">Simple Injector License</a></li>
<li class="toctree-l2"><a class="reference internal" href="legal.html#contributions">Contributions</a></li>
<li class="toctree-l2"><a class="reference internal" href="legal.html#simple-injector-trademark-policy">Simple Injector Trademark Policy</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="contribute.html">How to Contribute</a></li>
<li class="toctree-l1"><a class="reference internal" href="appendix.html">Appendix</a><ul>
<li class="toctree-l2"><a class="reference internal" href="RuntimeDecorators.html">Runtime Decorators</a></li>
<li class="toctree-l2"><a class="reference internal" href="InterceptionExtensions.html">    Interception Extensions</a></li>
<li class="toctree-l2"><a class="reference internal" href="CollectionRegistrationExtensions.html">    Collection Registration Extensions</a></li>
<li class="toctree-l2"><a class="reference internal" href="ContextDependentExtensions.html">    Context Dependent Extensions</a></li>
<li class="toctree-l2"><a class="reference internal" href="t4mvc.html">    T4MVC</a></li>
</ul>
</li>
</ul>

        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">Simple Injector</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Extensibility Points</li>
      <li class="wy-breadcrumbs-aside">
        
          <a href="_sources/extensibility.txt" rel="nofollow"> View page source</a>
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            
  <div class="section" id="extensibility-points">
<h1>Extensibility Points<a class="headerlink" href="#extensibility-points" title="Permalink to this headline">Â¶</a></h1>
<ul class="simple">
<li><a class="reference internal" href="#overriding-constructor-resolution-behavior"><em>Overriding Constructor Resolution Behavior</em></a></li>
<li><a class="reference internal" href="#overriding-parameter-injection-behavior"><em>Overriding Parameter Injection Behavior</em></a></li>
<li><a class="reference internal" href="#property-injection"><em>Property Injection</em></a></li>
<li><a class="reference internal" href="#overriding-parameter-injection-behavior"><em>Overriding Parameter Injection Behavior</em></a></li>
<li><a class="reference internal" href="#overriding-selection-behavior"><em>Overriding Lifestyle Selection Behavior</em></a></li>
<li><a class="reference internal" href="#intercepting-the-creation-of-types"><em>Intercepting the Creation of Types</em></a></li>
</ul>
<div class="section" id="overriding-constructor-resolution-behavior">
<span id="id1"></span><h2>Overriding Constructor Resolution Behavior<a class="headerlink" href="#overriding-constructor-resolution-behavior" title="Permalink to this headline">Â¶</a></h2>
<p>Out of the box, Simple Injector only allows the creation of classes that contain a single public constructor. This behavior is chosen deliberately because <a class="reference external" href="https://cuttingedge.it/blogs/steven/pivot/entry.php?id=97">having multiple constructors is an anti-pattern</a>.</p>
<p>There are some exceptional circumstances though, where we don&#8217;t control the amount of public constructors a type has. Code generators for instance, can have this annoying side effect. Earlier versions of the <a class="reference external" href="https://t4mvc.codeplex.com">T4MVC</a> template for instance did this.</p>
<p>In these rare cases we need to override the way Simple Injector does its constructor overload resolution. This can be done by creating custom implementation of <strong>IConstructorResolutionBehavior</strong>. The default behavior can be replaced by setting the <em>Container.Options.ConstructorResolutionBehavior</em> property.</p>
<div class="highlight-c#"><div class="highlight"><pre><span class="k">public</span> <span class="k">interface</span> <span class="n">IConstructorResolutionBehavior</span> <span class="p">{</span>
    <span class="n">ConstructorInfo</span> <span class="nf">GetConstructor</span><span class="p">(</span><span class="n">Type</span> <span class="n">serviceType</span><span class="p">,</span> <span class="n">Type</span> <span class="n">implementationType</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Simple Injector will call into the registered <strong>IConstructorResolutionBehavior</strong> when the type is registered to allow the <strong>IConstructorResolutionBehavior</strong> implementation to verify the type. The implementation is called again when the registered type is resolved for the first time.</p>
<p>The following example changes the constructor resolution behavior to always select the constructor with the most parameters (the greediest constructor):</p>
<div class="highlight-c#"><div class="highlight"><pre><span class="c1">// Custom constructor resolution behavior</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">GreediestConstructorBehavior</span> <span class="p">:</span> <span class="n">IConstructorResolutionBehavior</span> <span class="p">{</span>
    <span class="k">public</span> <span class="n">ConstructorInfo</span> <span class="nf">GetConstructor</span><span class="p">(</span><span class="n">Type</span> <span class="n">serviceType</span><span class="p">,</span> <span class="n">Type</span> <span class="n">implementationType</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="k">from</span> <span class="n">ctor</span> <span class="k">in</span> <span class="n">implementationType</span><span class="p">.</span><span class="n">GetConstructors</span><span class="p">()</span>
            <span class="k">orderby</span> <span class="n">ctor</span><span class="p">.</span><span class="n">GetParameters</span><span class="p">().</span><span class="n">Length</span> <span class="k">descending</span>
            <span class="k">select</span> <span class="n">ctor</span><span class="p">)</span>
            <span class="p">.</span><span class="n">First</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Usage</span>
<span class="kt">var</span> <span class="n">container</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Container</span><span class="p">();</span>
<span class="n">container</span><span class="p">.</span><span class="n">Options</span><span class="p">.</span><span class="n">ConstructorResolutionBehavior</span> <span class="p">=</span> <span class="k">new</span> <span class="n">GreediestConstructorBehavior</span><span class="p">();</span>
</pre></div>
</div>
<p>The following bit more advanced example changes the constructor resolution behavior to always select the constructor with the most parameters from the list of constructors with only resolvable parameters:</p>
<div class="highlight-c#"><div class="highlight"><pre><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Linq</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Reflection</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">SimpleInjector.Advanced</span><span class="p">;</span>

<span class="k">public</span> <span class="k">class</span> <span class="nc">MostResolvableConstructorBehavior</span> <span class="p">:</span> <span class="n">IConstructorResolutionBehavior</span> <span class="p">{</span>
    <span class="k">private</span> <span class="k">readonly</span> <span class="n">Container</span> <span class="n">container</span><span class="p">;</span>

    <span class="k">public</span> <span class="nf">MostResolvableConstructorBehavior</span><span class="p">(</span><span class="n">Container</span> <span class="n">container</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="n">container</span> <span class="p">=</span> <span class="n">container</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="kt">bool</span> <span class="n">IsCalledDuringRegistrationPhase</span> <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span> <span class="k">return</span> <span class="p">!</span><span class="k">this</span><span class="p">.</span><span class="n">container</span><span class="p">.</span><span class="n">IsLocked</span><span class="p">();</span> <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="n">ConstructorInfo</span> <span class="nf">GetConstructor</span><span class="p">(</span><span class="n">Type</span> <span class="n">serviceType</span><span class="p">,</span>
        <span class="n">Type</span> <span class="n">implementationType</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="k">from</span> <span class="n">ctor</span> <span class="k">in</span> <span class="n">implementationType</span><span class="p">.</span><span class="n">GetConstructors</span><span class="p">()</span>
            <span class="n">let</span> <span class="n">parameters</span> <span class="p">=</span> <span class="n">ctor</span><span class="p">.</span><span class="n">GetParameters</span><span class="p">()</span>
            <span class="k">orderby</span> <span class="n">parameters</span><span class="p">.</span><span class="n">Length</span> <span class="k">descending</span>
            <span class="k">where</span> <span class="k">this</span><span class="p">.</span><span class="n">IsCalledDuringRegistrationPhase</span> <span class="p">||</span>
                <span class="n">parameters</span><span class="p">.</span><span class="n">All</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">CanBeResolved</span><span class="p">)</span>
            <span class="k">select</span> <span class="n">ctor</span><span class="p">)</span>
            <span class="p">.</span><span class="n">First</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="kt">bool</span> <span class="nf">CanBeResolved</span><span class="p">(</span><span class="n">ParameterInfo</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="n">container</span><span class="p">.</span><span class="n">GetRegistration</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">ParameterType</span><span class="p">)</span> <span class="p">!=</span> <span class="k">null</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Usage</span>
<span class="kt">var</span> <span class="n">container</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Container</span><span class="p">();</span>
<span class="n">container</span><span class="p">.</span><span class="n">Options</span><span class="p">.</span><span class="n">ConstructorResolutionBehavior</span> <span class="p">=</span>
    <span class="k">new</span> <span class="nf">MostResolvableConstructorBehavior</span><span class="p">(</span><span class="n">container</span><span class="p">);</span>
</pre></div>
</div>
<p>The previous examples changed the constructor overload resolution for all registered types. This is usually not the best approach, since this promotes ambiguity in design of our classes. Since ambiguity is usually only a problem in code generation scenarios, it&#8217;s best to only override the behavior for types that are affected by the code generator. Take for instance this example for earlier versions of T4MVC:</p>
<div class="highlight-c#"><div class="highlight"><pre><span class="k">public</span> <span class="k">class</span> <span class="nc">T4MvcConstructorBehavior</span> <span class="p">:</span> <span class="n">IConstructorResolutionBehavior</span> <span class="p">{</span>
    <span class="k">private</span> <span class="n">IConstructorResolutionBehavior</span> <span class="n">defaultBehavior</span><span class="p">;</span>

    <span class="k">public</span> <span class="nf">T4MvcConstructorBehavior</span><span class="p">(</span>
        <span class="n">IConstructorResolutionBehavior</span> <span class="n">defaultBehavior</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="n">defaultBehavior</span> <span class="p">=</span> <span class="n">defaultBehavior</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="n">ConstructorInfo</span> <span class="nf">GetConstructor</span><span class="p">(</span><span class="n">Type</span> <span class="n">serviceType</span><span class="p">,</span> <span class="n">Type</span> <span class="n">impType</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">IController</span><span class="p">).</span><span class="n">IsAssignableFrom</span><span class="p">(</span><span class="n">impType</span><span class="p">))</span> <span class="p">{</span>
            <span class="kt">var</span> <span class="n">nonDefaultConstructors</span> <span class="p">=</span>
                <span class="k">from</span> <span class="n">constructor</span> <span class="k">in</span> <span class="n">impType</span><span class="p">.</span><span class="n">GetConstructors</span><span class="p">()</span>
                <span class="k">where</span> <span class="n">constructor</span><span class="p">.</span><span class="n">GetParameters</span><span class="p">().</span><span class="n">Length</span> <span class="p">&gt;</span> <span class="m">0</span>
                <span class="k">select</span> <span class="n">constructor</span><span class="p">;</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">nonDefaultConstructors</span><span class="p">.</span><span class="n">Count</span><span class="p">()</span> <span class="p">==</span> <span class="m">1</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="n">nonDefaultConstructors</span><span class="p">.</span><span class="n">Single</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">// fall back to the container&#39;s default behavior.</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="n">defaultBehavior</span><span class="p">.</span><span class="n">GetConstructor</span><span class="p">(</span><span class="n">serviceType</span><span class="p">,</span> <span class="n">impType</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Usage</span>
<span class="kt">var</span> <span class="n">container</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Container</span><span class="p">();</span>
<span class="n">container</span><span class="p">.</span><span class="n">Options</span><span class="p">.</span><span class="n">ConstructorResolutionBehavior</span> <span class="p">=</span>
    <span class="k">new</span> <span class="nf">T4MvcConstructorBehavior</span><span class="p">(</span><span class="n">container</span><span class="p">.</span><span class="n">Options</span><span class="p">.</span><span class="n">ConstructorResolutionBehavior</span><span class="p">);</span>
</pre></div>
</div>
<p>The old T4MVC template generated an extra public constructor on MVC Controller types and overload resolution only had to be changed for types implementing <em>System.Web.Mvc.IController</em>, which is what the previous code snippet does. For all other types of registration in the container, the container&#8217;s default behavior is used.</p>
</div>
<div class="section" id="property-injection">
<span id="id2"></span><h2>Property Injection<a class="headerlink" href="#property-injection" title="Permalink to this headline">Â¶</a></h2>
<p>Attribute based property injection and implicit property injection are not supported by Simple Injector out of the box. With attribute based property injection the container injects properties that are decorated with an attribute. With implicit property injection the container automatically injects all properties that can be mapped to a registration, but silently skips other properties. An extension point is provided to change the library&#8217;s default behavior, which is to <strong>not</strong> inject any property at all.</p>
<p>Out of the box, Simple Injector does allow explicit property injection based on registration of delegates using the <strong>RegisterInitializer</strong> method:</p>
<div class="highlight-c#"><div class="highlight"><pre><span class="n">container</span><span class="p">.</span><span class="n">Register</span><span class="p">&lt;</span><span class="n">ILogger</span><span class="p">,</span> <span class="n">FileLogger</span><span class="p">&gt;();</span>
<span class="n">container</span><span class="p">.</span><span class="n">RegisterInitializer</span><span class="p">&lt;</span><span class="n">FileLogger</span><span class="p">&gt;(</span><span class="n">instance</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="n">instance</span><span class="p">.</span><span class="n">Path</span> <span class="p">=</span> <span class="s">&quot;c:\logs\log.txt&quot;</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>
</div>
<p>This enables property injection on a per-type basis and it allows configuration errors to be spot by the C# compiler and is especially suited for injection of configuration values. Downside of this approach is that the <a class="reference internal" href="diagnostics.html"><em>Diagnostic Services</em></a> will not be able to analyze properties injected this way and although the <strong>RegisterInitializer</strong> can be called on base types and interfaces, it is cumbersome when applying property injection on a larger scale.</p>
<p>The Simple Injector API exposes the <strong>IPropertySelectionBehavior</strong> interface to change the way the library does property injection. The example below shows a custom <strong>IPropertySelectionBehavior</strong> implementation that enables attribute based property injection using any custom attribute:</p>
<div class="highlight-c#"><div class="highlight"><pre><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Linq</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Reflection</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">SimpleInjector.Advanced</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">PropertySelectionBehavior</span><span class="p">&lt;</span><span class="n">TAttribute</span><span class="p">&gt;</span> <span class="p">:</span> <span class="n">IPropertySelectionBehavior</span>
    <span class="k">where</span> <span class="n">TAttribute</span> <span class="p">:</span> <span class="n">Attribute</span> <span class="p">{</span>
    <span class="k">public</span> <span class="kt">bool</span> <span class="nf">SelectProperty</span><span class="p">(</span><span class="n">Type</span> <span class="n">type</span><span class="p">,</span> <span class="n">PropertyInfo</span> <span class="n">prop</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">prop</span><span class="p">.</span><span class="n">GetCustomAttributes</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">TAttribute</span><span class="p">)).</span><span class="n">Any</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Usage:</span>
<span class="kt">var</span> <span class="n">container</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Container</span><span class="p">();</span>
<span class="n">container</span><span class="p">.</span><span class="n">Options</span><span class="p">.</span><span class="n">PropertySelectionBehavior</span> <span class="p">=</span>
    <span class="k">new</span> <span class="n">PropertySelectionBehavior</span><span class="p">&lt;</span><span class="n">MyInjectAttribute</span><span class="p">&gt;();</span>
</pre></div>
</div>
<p>This enables explicit property injection on all properties that are marked with the supplied attribute (in this case <strong>MyInjectAttribute</strong>). In case a property is decorated that can&#8217;t be injected, the container will throw an exception.</p>
<div class="note container">
<strong>Tip</strong>: Dependencies injected by the container through the <strong>IPropertySelectionBehavior</strong> will be analyzed by the <a class="reference internal" href="diagnostics.html"><em>Diagnostic</em></a>.</div>
<p>Implicit property injection can be enabled by creating an <strong>IPropertySelectionBehavior</strong> implementation that queries the container to check whether the property&#8217;s type to be registered in the container:</p>
<div class="highlight-c#"><div class="highlight"><pre><span class="k">public</span> <span class="k">class</span> <span class="nc">ImplicitPropertyInjectionBehavior</span> <span class="p">:</span> <span class="n">IPropertySelectionBehavior</span> <span class="p">{</span>
    <span class="k">private</span> <span class="k">readonly</span> <span class="n">Container</span> <span class="n">container</span><span class="p">;</span>
    <span class="k">internal</span> <span class="nf">ImplicitPropertyInjectionBehavior</span><span class="p">(</span><span class="n">Container</span> <span class="n">container</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="n">container</span> <span class="p">=</span> <span class="n">container</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="kt">bool</span> <span class="nf">SelectProperty</span><span class="p">(</span><span class="n">Type</span> <span class="n">type</span><span class="p">,</span> <span class="n">PropertyInfo</span> <span class="n">property</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="n">IsImplicitInjectable</span><span class="p">(</span><span class="n">property</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="kt">bool</span> <span class="nf">IsImplicitInjectable</span><span class="p">(</span><span class="n">PropertyInfo</span> <span class="n">property</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nf">IsInjectableProperty</span><span class="p">(</span><span class="n">property</span><span class="p">)</span> <span class="p">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="n">IsAvailable</span><span class="p">(</span><span class="n">property</span><span class="p">.</span><span class="n">PropertyType</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">static</span> <span class="kt">bool</span> <span class="nf">IsInjectableProperty</span><span class="p">(</span><span class="n">PropertyInfo</span> <span class="n">prop</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">MethodInfo</span> <span class="n">setMethod</span> <span class="p">=</span> <span class="n">prop</span><span class="p">.</span><span class="n">GetSetMethod</span><span class="p">(</span><span class="n">nonPublic</span><span class="p">:</span> <span class="k">false</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">setMethod</span> <span class="p">!=</span> <span class="k">null</span> <span class="p">&amp;&amp;</span> <span class="p">!</span><span class="n">setMethod</span><span class="p">.</span><span class="n">IsStatic</span> <span class="p">&amp;&amp;</span> <span class="n">prop</span><span class="p">.</span><span class="n">CanWrite</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="kt">bool</span> <span class="nf">IsAvailable</span><span class="p">(</span><span class="n">Type</span> <span class="n">serviceType</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="n">container</span><span class="p">.</span><span class="n">GetRegistration</span><span class="p">(</span><span class="n">serviceType</span><span class="p">)</span> <span class="p">!=</span> <span class="k">null</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Usage:</span>
<span class="kt">var</span> <span class="n">container</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Container</span><span class="p">();</span>
<span class="n">container</span><span class="p">.</span><span class="n">Options</span><span class="p">.</span><span class="n">PropertySelectionBehavior</span> <span class="p">=</span>
    <span class="k">new</span> <span class="nf">ImplicitPropertyInjectionBehavior</span><span class="p">(</span><span class="n">container</span><span class="p">);</span>
</pre></div>
</div>
<div class="note container">
<strong>Warning</strong>: Silently skipping properties that can&#8217;t be mapped can lead to a DI configuration that can&#8217;t be easily verified and can therefore result in an application that fails at runtime instead of failing when the container is verified. Prefer explicit property injection -or better- constructor injection whenever possible.</div>
</div>
<div class="section" id="overriding-parameter-injection-behavior">
<span id="id3"></span><h2>Overriding Parameter Injection Behavior<a class="headerlink" href="#overriding-parameter-injection-behavior" title="Permalink to this headline">Â¶</a></h2>
<p>Simple Injector does not allow injecting primitive types (such as integers and string) into constructors. The <strong>IConstructorInjectionBehavior</strong> interface is defined by the library to change this default behavior.</p>
<p>The following article contains more information about changing the library&#8217;s default behavior: <a class="reference external" href="https://cuttingedge.it/blogs/steven/pivot/entry.php?id=94">Primitive Dependencies with the Simple Injector</a>.</p>
</div>
<div class="section" id="resolving-unregistered-types">
<span id="id4"></span><h2>Resolving Unregistered Types<a class="headerlink" href="#resolving-unregistered-types" title="Permalink to this headline">Â¶</a></h2>
<p>Unregistered type resolution is the ability to get notified by the container when a type is requested that is currently unregistered in the container. This gives you the change of registering that type. Simple Injector supports this scenario with the <a class="reference external" href="https://simpleinjector.org/ReferenceLibrary/?topic=html/E_SimpleInjector_Container_ResolveUnregisteredType.htm">ResolveUnregisteredType</a> event. Unregistered type resolution enables many advanced scenarios. The library itself uses this event for implementing the <a class="reference internal" href="advanced.html#registration-of-open-generic-types"><em>registration of open generic types</em></a>. Other examples of possible scenarios that can be built on top of this event are <a class="reference internal" href="howto.html#resolve-arrays-and-lists"><em>resolving array and lists</em></a> and <a class="reference internal" href="advanced.html#covariance-contravariance"><em>covariance and contravariance</em></a>. Those scenarios are described here in the advanced scenarios page.</p>
<p>For more information about how to use this event, please look at the <a class="reference external" href="https://simpleinjector.org/ReferenceLibrary/?topic=html/E_SimpleInjector_Container_ResolveUnregisteredType.htm">ResolveUnregisteredType event documentation</a> in the <a class="reference external" href="https://simpleinjector.org/ReferenceLibrary/">reference library</a>.</p>
</div>
<div class="section" id="overriding-lifestyle-selection-behavior">
<span id="overriding-selection-behavior"></span><h2>Overriding Lifestyle Selection Behavior<a class="headerlink" href="#overriding-lifestyle-selection-behavior" title="Permalink to this headline">Â¶</a></h2>
<p>By default, when registering a type without explicitly specifying a lifestyle, that type is registered using the <strong>Transient</strong> lifestyle. Since Simple Injector 2.6 this behavior can be overridden and this is especially useful in batch-registration scenarios.</p>
<p>Here are some examples of registration calls that all register types as <em>transient</em>:</p>
<div class="highlight-c#"><div class="highlight"><pre><span class="n">container</span><span class="p">.</span><span class="n">Register</span><span class="p">&lt;</span><span class="n">IUserContext</span><span class="p">,</span> <span class="n">AspNetUserContext</span><span class="p">&gt;();</span>
<span class="n">container</span><span class="p">.</span><span class="n">Register</span><span class="p">&lt;</span><span class="n">ITimeProvider</span><span class="p">&gt;(()</span> <span class="p">=&gt;</span> <span class="k">new</span> <span class="n">RealTimeProvider</span><span class="p">());</span>
<span class="n">container</span><span class="p">.</span><span class="n">RegisterAll</span><span class="p">&lt;</span><span class="n">ILogger</span><span class="p">&gt;(</span><span class="k">typeof</span><span class="p">(</span><span class="n">SqlLogger</span><span class="p">),</span> <span class="k">typeof</span><span class="p">(</span><span class="n">FileLogger</span><span class="p">));</span>
<span class="n">container</span><span class="p">.</span><span class="n">RegisterManyForOpenGeneric</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">ICommandHandler</span><span class="p">&lt;&gt;),</span>
    <span class="k">typeof</span><span class="p">(</span><span class="n">ICommandHandler</span><span class="p">&lt;&gt;).</span><span class="n">Assembly</span><span class="p">);</span>
<span class="n">container</span><span class="p">.</span><span class="n">RegisterDecorator</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">ICommandHandler</span><span class="p">&lt;&gt;),</span>
    <span class="k">typeof</span><span class="p">(</span><span class="n">LoggingCommandHandlerDecorator</span><span class="p">&lt;&gt;));</span>
<span class="n">container</span><span class="p">.</span><span class="n">RegisterOpenGeneric</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">IValidator</span><span class="p">&lt;&gt;),</span> <span class="k">typeof</span><span class="p">(</span><span class="n">NullValidator</span><span class="p">&lt;&gt;));</span>
<span class="n">container</span><span class="p">.</span><span class="n">RegisterMvcControllers</span><span class="p">();</span>
<span class="n">container</span><span class="p">.</span><span class="n">RegisterWcfServices</span><span class="p">();</span>
<span class="n">container</span><span class="p">.</span><span class="n">RegisterWebApiControllers</span><span class="p">(</span><span class="n">GlobalConfiguration</span><span class="p">.</span><span class="n">Configuration</span><span class="p">);</span>
</pre></div>
</div>
<p>Most of these methods have overloads that allow supplying a different lifestyle. This works great in situations where you register a single type (using one of the <strong>Register</strong> method overloads for instance), and when all registrations need the same lifestyle. This is less suitable for cases where you batch-register a set of types where each type needs a different lifestyle.</p>
<p>In this case we need to override the way Simple Injector does lifestyle selection. This can be done by creating custom implementation of <strong>ILifestyleSelectionBehavior</strong>.</p>
<div class="highlight-c#"><div class="highlight"><pre><span class="k">public</span> <span class="k">interface</span> <span class="n">ILifestyleSelectionBehavior</span> <span class="p">{</span>
    <span class="n">Lifestyle</span> <span class="nf">SelectLifestyle</span><span class="p">(</span><span class="n">Type</span> <span class="n">serviceType</span><span class="p">,</span> <span class="n">Type</span> <span class="n">implementationType</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>When no lifestyle is explicitly supplied by the user, Simple Injector will call into the registered <strong>ILifestyleSelectionBehavior</strong> when the type is registered to allow the <strong>ILifestyleSelectionBehavior</strong> implementation to select the proper lifestyle. The default behavior can be replaced by setting the <em>Container.Options.LifestyleSelectionBehavior</em> property.</p>
<p>The following (not very useful) example changes the lifestyle selection behavior to always register those instances as singleton:</p>
<div class="highlight-c#"><div class="highlight"><pre><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">SimpleInjector</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">SimpleInjector.Advanced</span><span class="p">;</span>

<span class="c1">// Custom lifestyle selection behavior</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">SingletonLifestyleSelectionBehavior</span> <span class="p">:</span> <span class="n">ILifestyleSelectionBehavior</span> <span class="p">{</span>
    <span class="k">public</span> <span class="n">Lifestyle</span> <span class="nf">SelectLifestyle</span><span class="p">(</span><span class="n">Type</span> <span class="n">serviceType</span><span class="p">,</span> <span class="n">Type</span> <span class="n">implementationType</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">Lifestyle</span><span class="p">.</span><span class="n">Singleton</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Usage</span>
<span class="kt">var</span> <span class="n">container</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Container</span><span class="p">();</span>
<span class="n">container</span><span class="p">.</span><span class="n">Options</span><span class="p">.</span><span class="n">LifestyleSelectionBehavior</span> <span class="p">=</span>
    <span class="k">new</span> <span class="nf">SingletonLifestyleSelectionBehavior</span><span class="p">();</span>
</pre></div>
</div>
<p>The following example changes the lifestyle selection behavior to pick the lifestyle based on an attribute:</p>
<div class="highlight-c#"><div class="highlight"><pre><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Reflection</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">SimpleInjector.Advanced</span><span class="p">;</span>

<span class="c1">// Attribute for use by the application</span>
<span class="k">public</span> <span class="k">enum</span> <span class="n">CreationPolicy</span> <span class="p">{</span> <span class="n">Transient</span><span class="p">,</span> <span class="n">Scoped</span><span class="p">,</span> <span class="n">Singleton</span> <span class="p">}</span>

<span class="na">[AttributeUsage(AttributeTargets.Class | AttributeTargets.Interface,</span>
<span class="na">    Inherited = false, AllowMultiple = false)]</span>
<span class="k">public</span> <span class="k">sealed</span> <span class="k">class</span> <span class="nc">CreationPolicyAttribute</span> <span class="p">:</span> <span class="n">Attribute</span> <span class="p">{</span>
    <span class="k">public</span> <span class="nf">CreationPolicyAttribute</span><span class="p">(</span><span class="n">CreationPolicy</span> <span class="n">policy</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="n">Policy</span> <span class="p">=</span> <span class="n">policy</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="n">CreationPolicy</span> <span class="n">Policy</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">private</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Custom lifestyle selection behavior</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">AttributeBasedLifestyleSelectionBehavior</span> <span class="p">:</span> <span class="n">ILifestyleSelectionBehavior</span> <span class="p">{</span>
    <span class="k">private</span> <span class="k">const</span> <span class="n">CreationPolicy</span> <span class="n">DefaultPolicy</span> <span class="p">=</span> <span class="n">CreationPolicy</span><span class="p">.</span><span class="n">Transient</span><span class="p">;</span>
    <span class="k">private</span> <span class="k">readonly</span> <span class="n">ScopedLifestyle</span> <span class="n">scopedLifestyle</span><span class="p">;</span>

    <span class="k">public</span> <span class="nf">AttributeBasedLifestyleSelectionBehavior</span><span class="p">(</span><span class="n">ScopedLifestyle</span> <span class="n">scopedLifestyle</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="n">scopedLifestyle</span> <span class="p">=</span> <span class="n">scopedLifestyle</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="n">Lifestyle</span> <span class="nf">SelectLifestyle</span><span class="p">(</span><span class="n">Type</span> <span class="n">serviceType</span><span class="p">,</span> <span class="n">Type</span> <span class="n">implementationType</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">var</span> <span class="n">attribute</span> <span class="p">=</span> <span class="n">implementationType</span><span class="p">.</span><span class="n">GetCustomAttribute</span><span class="p">&lt;</span><span class="n">CreationPolicyAttribute</span><span class="p">&gt;()</span>
            <span class="p">??</span> <span class="n">serviceType</span><span class="p">.</span><span class="n">GetCustomAttribute</span><span class="p">&lt;</span><span class="n">CreationPolicyAttribute</span><span class="p">&gt;();</span>

        <span class="kt">var</span> <span class="n">policy</span> <span class="p">=</span> <span class="n">attribute</span> <span class="p">==</span> <span class="k">null</span> <span class="p">?</span> <span class="n">DefaultPolicy</span> <span class="p">:</span> <span class="n">attribute</span><span class="p">.</span><span class="n">Policy</span><span class="p">;</span>

        <span class="k">switch</span> <span class="p">(</span><span class="n">policy</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">case</span> <span class="n">CreationPolicy</span><span class="p">.</span><span class="n">Singleton</span><span class="p">:</span> <span class="k">return</span> <span class="n">Lifestyle</span><span class="p">.</span><span class="n">Singleton</span><span class="p">;</span>
            <span class="k">case</span> <span class="n">CreationPolicy</span><span class="p">.</span><span class="n">Scoped</span><span class="p">:</span> <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="n">scopedLifestyle</span><span class="p">;</span>
            <span class="k">default</span><span class="p">:</span> <span class="k">return</span> <span class="n">Lifestyle</span><span class="p">.</span><span class="n">Transient</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Usage</span>
<span class="kt">var</span> <span class="n">container</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Container</span><span class="p">();</span>

<span class="c1">// Create a scope lifestyle (if needed)</span>
<span class="n">ScopedLifestyle</span> <span class="n">scopedLifestyle</span> <span class="p">=</span> <span class="k">new</span> <span class="n">WebRequestLifestyle</span><span class="p">();</span>

<span class="n">container</span><span class="p">.</span><span class="n">Options</span><span class="p">.</span><span class="n">LifestyleSelectionBehavior</span> <span class="p">=</span>
    <span class="k">new</span> <span class="nf">AttributeBasedLifestyleSelectionBehavior</span><span class="p">(</span><span class="n">scopedLifestyle</span><span class="p">);</span>

<span class="n">container</span><span class="p">.</span><span class="n">Register</span><span class="p">&lt;</span><span class="n">IUserContext</span><span class="p">,</span> <span class="n">AspNetUserContext</span><span class="p">&gt;();</span>

<span class="c1">// Usage in application</span>
<span class="na">[CreationPolicy(CreationPolicy.Scoped)]</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">AspNetUserContext</span> <span class="p">:</span> <span class="n">IUserContext</span> <span class="p">{</span>
    <span class="c1">// etc</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="intercepting-the-creation-of-types">
<span id="id5"></span><h2>Intercepting the Creation of Types<a class="headerlink" href="#intercepting-the-creation-of-types" title="Permalink to this headline">Â¶</a></h2>
<p>Interception the creation of types allows registrations to be modified. This enables all sorts of advanced scenarios where the creation of a single type or whole object graphs gets altered. Simple Injector contains two events that allow altering the type&#8217;s creation: <a class="reference external" href="https://simpleinjector.org/ReferenceLibrary/?topic=html/E_SimpleInjector_Container_ExpressionBuilding.htm">ExpressionBuilding</a> and <a class="reference external" href="https://simpleinjector.org/ReferenceLibrary/?topic=html/E_SimpleInjector_Container_ExpressionBuilding.htm">ExpressionBuilt</a>. Both events are quite similar but are called in different stages of the <a class="reference internal" href="pipeline.html#resolve-pipeline"><em>building process</em></a>.</p>
<p>The <strong>ExpressionBuilding</strong> event gets called just after the registrations expression has been created that new up a new instance of that type, but before any lifestyle caching has been applied. This event can for instance be used for <a class="reference internal" href="advanced.html#context-based-injection"><em>Context based injection</em></a>.</p>
<p>The <strong>ExpressionBuilt</strong> event gets called after the lifestyle caching has been applied. After lifestyle caching is applied much of the information that was available about the creation of that registration during the time <strong>ExpressionBuilding</strong> was called, is gone. While <strong>ExpressionBuilding</strong> is especially suited for changing the relationship between the resolved type and its dependencies, <strong>ExpressionBuilt</strong> is especially useful for applying decorators or <a class="reference internal" href="advanced.html#interception"><em>applying interceptors</em></a>. Note that Simple Injector has built-in support for <a class="reference internal" href="advanced.html#decorators"><em>applying decorators</em></a> using the <a class="reference external" href="https://simpleinjector.org/ReferenceLibrary/?topic=html/Overload_SimpleInjector_Extensions_DecoratorExtensions_RegisterDecorator.htm">RegisterDecorator</a> extension methods. These methods internally use the <strong>ExpressionBuilt</strong> event.</p>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="pipeline.html" class="btn btn-neutral float-right" title="Simple Injector Pipeline"/>Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="advanced.html" class="btn btn-neutral" title="Advanced Scenarios"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2014, Simple Injector Contributors.
    </p>
  </div>

  <a href="https://github.com/snide/sphinx_rtd_theme">Sphinx theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'2',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>